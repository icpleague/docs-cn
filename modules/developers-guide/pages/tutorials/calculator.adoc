= 在计算器函数中使用整数
ifdef::env-github,env-browser[:outfilesuffix:.adoc]
:proglang: Motoko
:IC: 互联网计算机
:company-id: DFINITY

在本教程中，您将编写一个简单的计算器程序，该程序创建一个具有多个公共入口点函数的单个参与者，以执行基本的算术运算。

在本教程中，actor 被命名为 `+Calc+`。
该程序使用 `+cell+` 变量来包含一个整数，该整数表示计算器操作的当前结果。

该程序支持以下函数调用:

* `+add+` 函数调用接受输入并执行加法。
* `+sub+` 函数调用接受输入并执行减法。
* `+mul+` 函数调用接受输入并执行乘法。
* `+div+` 函数调用接受输入并执行除法。
* `+clearall+` 函数清除作为先前操作结果存储的`+cell+` 值，将`+cell+` 值重置为零。

`+div+` 函数还包括防止程序试图除以零的代码。

== 开始之前

在开始本教程之前，请验证以下内容:

* 您已按照link:../../quickstart/local-quickstart{outfilesuffix}#download-and-install[下载并安装]中的说明下载并安装了 {sdk-short-name} 包。
* 您已停止在本地运行的任何容器执行环境
计算机。

完成本教程大约需要 20 分钟。

== 创建一个新项目

要为本教程创建一个新项目:

[arabic]
. 如果您还没有打开一个终端外壳，请在您的本地计算机上打开一个终端外壳。
. 更改为您用于 {IC} 项目的文件夹（如果您正在使用一个）。
. 通过运行以下命令创建一个新项目:
+
[source,bash]
----
dfx new calc
----
. 通过运行以下命令切换到您的项目目录:
+
[source,bash]
----
cd calc
----

== 修改默认配置

对于本教程，让我们修改默认的“dfx.json”配置文件，为其主程序使用更具体的名称。

修改默认的 `+dfx.json+` 配置文件:

. 在文本编辑器中打开 `+dxf.json` 配置文件。
. 将 `+main+` 键设置从默认的 `+main.mo+` 程序名称更改为 `+calc_main.mo+`。
+
例如:
+
[source,bash]
----
"main": "src/calc/calc_main.mo",
----
+
对于本教程，将源文件的名称从 `+main.mo+` 更改为 `+calc_main.mo+` 只是说明了 `+dfx.json+` 配置文件中的设置如何确定要编译的源文件。
+
在更复杂的 dapp 中，您可能有多个源文件而不是单个 `+main+` 程序文件。
更复杂的应用程序可能还具有多个源文件之间的特定依赖关系，您需要使用 `+dfx.json+` 配置文件中的设置来管理这些依赖关系。
在这样的场景中——在你的“dfx.json”文件中定义了多个容器和程序——拥有多个名为“main.mo”的文件可能会使你的工作区导航变得更加困难。
您为每个程序选择的名称并不重要，但重要的是您在 `+dfx.json+` 文件中设置的名称与文件系统中的程序名称相匹配。
. 保存更改并关闭文件以继续。

== 修改默认程序

对于本教程，您需要将默认程序替换为执行基本算术运算的程序。

要替换默认程序:

. 如果需要，请检查您是否仍在项目目录中。
. 复制模板 `+main.mo+` 文件，通过运行以下命令创建一个名为 `+calc_main.mo+` 的新文件:
+
[source,bash]
----
cp src/calc/main.mo src/calc/calc_main.mo
----
. 在文本编辑器中打开 `+src/calc/calc_main.mo+` 文件并删除现有内容。
. 将以下示例代码复制并粘贴到 `+calc_main.mo+` 文件中:
+
[source.copy,motoko,no-repl]
----
include::example$calc_main.mo[]
----
+
您可能会注意到此示例代码使用整数 (`+Int+`) 数据类型，使您能够使用正数或负数。
如果您想将此计算器代码中的函数限制为仅使用正数，您可以将数据类型更改为仅允许自然 (`+Nat+`) 数据。
. 保存更改并关闭文件以继续。


== 启动本地容器执行环境


在构建 `+calc+` 项目之前，您需要连接到在您的开发环境中本地运行的容器执行环境，或者您需要连接到您可以访问的子网。


在本地启动网络需要一个 `+dfx.json+` 文件，因此您应该确保您位于项目的根目录中。
对于本教程，您应该有两个独立的终端 shell，以便您可以在一个终端中启动和查看网络操作并在另一个终端中管理您的项目。

启动本地容器执行环境:

[arabic]
. 在本地计算机上打开一个新的终端窗口或选项卡。
. 如有必要，导航到项目的根目录。
+
--
* 您现在应该打开了**两个终端**。
* 您应该将 **project 目录** 作为您的 **current 工作目录**。
--
. 通过运行以下命令在您的机器上启动本地容器执行环境:
+
[source,bash]
----
dfx start
----
+
启动本地网络后，终端会显示有关网络操作的消息。
. 让显示网络操作的终端保持打开状态，然后将注意力转移到创建新项目的原始终端。

== 注册、构建和部署 dapp

连接到本地容器执行环境后，您可以在本地注册、构建和部署 dapp。

要在本地部署 dapp:

. 如果需要，请检查您是否仍在项目的根目录中。
. 通过运行以下命令注册、构建和部署您的 dapp:
+
[source,bash]
----
dfx deploy
----
+
`+dfx deploy+` 命令输出显示有关它执行的操作的信息。

== 验证容器上的计算器功能

您现在在本地容器执行环境中部署了一个程序作为*容器智能合约*。
您可以使用 `+dfx canister call+` 命令测试程序。

要测试您已部署的程序:

. 使用 `+dfx canister call+` 命令调用 `+calc+` 容器 `+add+` 函数，并通过运行以下命令将输入参数 `+10+` 传递给它:
+
[source,bash]
----
dfx canister call calc add '(10)'
----
+
当您传递由单引号和括号括起来的参数时，接口描述语言 (IDL) 会解析参数类型，因此您无需手动指定参数类型。
+
验证该命令是否返回 `+add+` 函数的预期值。
例如，程序显示类似于以下的输出:
+
....
(10)
....
. 调用 `+mul+` 函数并通过运行以下命令将输入参数 `+3+` 传递给它:
+
[source,bash]
----
dfx canister call calc mul '(3)'
----
+
验证命令是否返回 `+mul+` 函数的预期值。
例如，程序显示类似于以下的输出:
+
....
(30)
....
. 调用`+sub+`函数并通过运行以下命令将`+number+`类型的输入参数`+5+`传递给它:
+
[source,bash]
----
dfx canister call calc sub '(5)'
----
+
验证命令是否返回 `+sub+` 函数的预期值。
例如，程序显示类似于以下的输出:
+
....
(25)
....
. 调用 `+div+` 函数并通过运行以下命令将输入参数 `+5+` 传递给它:
+
[source,bash]
----
dfx canister call calc div '(5)'
----
+
验证命令是否返回 `+div+` 函数的预期值。
例如，程序显示类似于以下的输出:
+
....
(opt 5)
....
+
您可能会注意到 `+div+` 函数返回一个可选结果。
该程序使结果可选，以使 `+div+` 函数在除零错误的情况下返回 `+null+`。
+
因为这个程序中的单元格变量是一个整数，你也可以调用它的函数并指定负输入值。
例如，您可以运行以下命令:
+
[source,bash]
----
dfx canister call calc mul '(-4)'
----
+
which returns:
+
....
(-20)
....
. 调用 `+clearall` 函数并验证它是否将 `+cell` 值重置为零:
+
[source,bash]
----
dfx canister call calc clearall
----
+
例如，程序显示类似于以下的输出:
+
....
(0)
....

include::example$candid-ui.adoc[]
+
image:candid-calc.png[Calculator functions]

== 停止本地容器执行环境



完成 dapp 试验后，您可以停止本地容器执行环境，使其不会继续在后台运行。


要停止本地容器执行环境:

. 在显示操作的终端中，按 Control-C 中断该过程。

. 通过运行以下命令停止本地容器执行环境:
+
[source,bash]
----
dfx stop
----
